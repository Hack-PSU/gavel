{% extends "layout.html" %}
{% block title %}Closed{% endblock %}

{% block content %}
<div class="item">
  <div class="banner" id="closed-header">
    <h1>Judging Closed</h1>
    <p>Here are all projects and notes from all judges:</p>
  </div>

  <div id="projects-container">
    <p><i>Loading notes...</i></p>
  </div>
</div>

<script>
  async function fetchAllNotes() {
    try {
      const res = await fetch('/api/all_notes');
      if (!res.ok) throw new Error('Network error');
      const data = await res.json();

      const container = document.getElementById('projects-container');
      container.innerHTML = "";

      if (data.length === 0) {
        container.innerHTML = "<p><i>No notes available yet...</i></p>";
        return;
      }

      data.forEach(item => {
        const div = document.createElement('div');
        div.classList.add('project');
        div.style.marginBottom = '1.5rem';
        div.innerHTML = `
          <h3>${item.project}</h3>
          <ul>
            ${item.notes.map(note => `<li>${note}</li>`).join('')}
          </ul>
        `;
        container.appendChild(div);
      });
    } catch (err) {
      console.error('Error fetching notes:', err);
    }
  }

  // Fetch immediately and auto-refresh every 1 seconds
  fetchAllNotes();
  setInterval(fetchAllNotes, 1000);
</script>
{% endblock %}
